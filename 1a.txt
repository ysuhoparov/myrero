
#include <iostream>
#include <string>
#include <fstream>
#include <ctime>

/*Формат ведомости прежний.Сначала идёт имя и фамилия получателя денежных средств,
далее располагается дата выдачи в формате ДД.ММ.ГГГГ.Завершает запись сумма выплаты
в рублях.Данные разделяются между собой пробелами.В конце каждой записи должен быть
расположен перевод строки.*/

int main() {

	using namespace std;


	string info;
	string many;
	string mdate;

	int i, idate, imon, iyear;
	string::size_type sz;

	ofstream file;

	file.open("sheet.txt",ios::app);
	if (!file) {
		cout << "Error open file\n";
		return 1;
	}

	while (1) {

		cout << "\nName Fname ('-' -> quit) : ";
		cin.ignore();
		getline(cin, info);

		if (info[0] == '-') {
			file.close();
			return 0;
		}

		cout << "\nAmount : "; cin >> many; // only digit

		do {
			cout << "\nDate (DD.MM.YYYY : ";
			cin >> mdate;

			for (i = 0; i < mdate.size(); i++) {

				if (i == 2 || i == 5) {
					if (mdate[i] != '.') continue;
				}
				else
					if (!(isdigit(mdate[i]))) continue;
			}

			idate = stoi(mdate.substr(0, 2), &sz);
			if (idate > 31 || idate < 1) continue;

			imon = stoi(mdate.substr(3, 5), &sz);
			if (imon > 12 || imon < 1) continue;

			if((imon == 4 || imon == 6 || imon == 9 || imon == 11) && idate >30) continue;

			if ((imon == 4 || imon == 6 || imon == 9 || imon == 11) && idate > 30) continue;

			iyear = stoi(mdate.substr(6, 10), &sz);
			if (iyear > 2022 || iyear < 2000) continue;

			if (imon == 2)							// упрощенно
				if ((iyear%4) && idate >28) continue;      
				if (!(iyear % 4) && idate > 29) continue;

			break;

		} while (1);

		file << info << " " << mdate << " " << many << "\n";
	}
	file.close();

	return 0;
}